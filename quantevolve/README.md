# QuantEvolve: Evolutionary Quantitative Trading Strategy Development

This example demonstrates how to use QuantEvolve to automatically develop and optimize quantitative trading strategies. The core idea is to leverage Large Language Models (LLMs) to evolve a Python trading strategy function. The LLM iteratively refines the strategy based on its performance in backtests conducted on historical market data.

## System Components

The QuantEvolve example consists of the following key files and directories:

-   `market_data_collector.py`: A Python script to fetch historical OHLCV (Open, High, Low, Close, Volume) market data from the Binance exchange.
-   `initial_strategy.py`: Contains the initial, simple trading strategy (e.g., a Simple Moving Average crossover) that QuantEvolve will iteratively improve. The LLM's modifications will be focused within designated "evolve blocks" in this file.
-   `quant_evaluator.py`: A Python script that backtests the trading strategies generated by QuantEvolve. It calculates various performance metrics such as Profit and Loss (PnL), Sharpe Ratio, and Maximum Drawdown, which guide the evolution process.
-   `config_quant_evolve.yaml`: The configuration file for QuantEvolve. It specifies settings for the LLM (e.g., model names, API details), the system prompt that guides the LLM, and parameters for the evolutionary algorithm.
-   `data/`: This directory is created by `market_data_collector.py` and stores the downloaded market data in CSV format (e.g., `btc_usdt_1h_2023.csv`).
-   `README.md`: This file, providing an overview and instructions.

## Setup Instructions

### API Keys

-   **LLM Provider:** You will need API keys for Google Gemini API.
    -   Set the `GOOGLE_API_KEY` environment variable with your key:
        ```bash
        export GOOGLE_API_KEY="your_google_api_key_here"
        ```
    -   If you need to use a different API base URL, you can set the `GOOGLE_API_BASE` environment variable or update the `api_base` field in `config_quant_evolve.yaml`.
-   **Binance API (Optional):**
    -   `market_data_collector.py` fetches public historical kline data from Binance, which generally does not require API keys.
    -   If you encounter rate limits or wish to access account-specific data in more advanced scenarios, you might need to set `BINANCE_API_KEY` and `BINANCE_API_SECRET` environment variables. The script will prompt if these are needed but not set.

### Python Environment & Dependencies

1.  **Create a Virtual Environment (Recommended):**
    It's good practice to create a virtual environment to manage project dependencies.
    ```bash
    python -m venv quant_env
    source quant_env/bin/activate  # On Windows use: quant_env\Scripts\activate
    ```

2.  **Install QuantEvolve:**
    If you haven't already, navigate to the root directory of the QuantEvolve project and install it in editable mode:
    ```bash
    pip install -e .
    ```

3.  **Install Example-Specific Dependencies:**
    Install the necessary Python libraries for this example:
    ```bash
    pip install python-binance pandas numpy
    ```
    Note: `quantevolve` itself manages its core dependencies like `google-generativeai`.

## Running the QuantEvolve Example

Follow these steps to run the evolutionary trading strategy development process:

### Step 1: Fetch Market Data

Run the `market_data_collector.py` script to download historical market data. This example defaults to fetching 1-hour BTC/USDT data for the year 2023.
```bash
python -m quantevolve.data.market_data_collector
```
This command will create a file, typically `quantevolve/data/btc_usdt_1h_2023.csv` or in the configured data directory.

### Step 2: Run QuantEvolve

Once the market data is available, start the QuantEvolve process using the following command:
```bash
python -m quantevolve.cli quantevolve/strategy/initial_strategy.py quantevolve/evaluation/quant_evaluator.py --config configs/quantevolve_config.yaml --output_dir quantevolve_output
```

**Command Arguments Explained:**

-   `quantevolve/strategy/initial_strategy.py`: Path to the initial Python script containing the trading strategy to be evolved.
-   `quantevolve/evaluation/quant_evaluator.py`: Path to the Python script that evaluates the performance of each evolved strategy.
-   `--config configs/quantevolve_config.yaml`: Path to the YAML configuration file for this task.
-   `--output_dir quantevolve_output`: Directory where QuantEvolve will save all its outputs, including logs, checkpoints, and the best-evolved strategy.

You can adjust the `max_iterations` parameter in `config_quant_evolve.yaml` to control the duration of the evolution process.

## Expected Output and Results

QuantEvolve will create the specified output directory (e.g., `quantevolve_output/`). Inside this directory, you will find:

-   `logs/`: Contains detailed logs of the evolutionary process, including LLM interactions and evaluation results. This is useful for monitoring and debugging.
-   `checkpoints/`: Stores periodic checkpoints of the evolution state. Each checkpoint includes the current population of strategies and the best program found up to that point.
-   `best/`:
    -   `best_program.py`: The Python script of the best overall trading strategy found during the entire run.
    -   `best_program_info.json`: A JSON file containing metadata and performance metrics for the best program.

During the run, the console output from `quantevolve-run.py` will display progress, including the current iteration, evaluation scores of new strategies, and information about the best strategy found so far.

After the run completes, inspect `best/best_program.py` to see the trading strategy that QuantEvolve has developed.

## Customization (Optional)

This example provides a foundation that you can customize for your own experiments:

-   **Configuration (`config_quant_evolve.yaml`):**
    -   Experiment with different Gemini models (e.g., `gemini-2.0-flash`, `gemini-2.5-flash`, `gemini-2.5-pro`, etc.).
    -   Refine the `system_message` in the prompt to guide the LLM's behavior differently.
    -   Adjust evolutionary parameters (population size, selection ratios, etc.).
-   **Market Data:**
    -   Modify `market_data_collector.py` to fetch data for different trading symbols (e.g., `ETHUSDT`), time intervals (e.g., `Client.KLINE_INTERVAL_1DAY`), or date ranges.
-   **Initial Strategy (`initial_strategy.py`):**
    -   Provide a different starting point for the evolution. You could start with a completely different type of strategy or a more complex one.
    -   Modify the `get_parameters()` function to provide different default parameters or a different number of parameters for the strategy to use.

By adjusting these components, you can tailor the QuantEvolve example to explore a wide range of trading strategy development scenarios.
